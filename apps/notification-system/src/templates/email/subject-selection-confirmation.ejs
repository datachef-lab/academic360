<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title><%= content && content.subject ? content.subject : "Confirmation of Semester-wise Subject Selection" %></title>
    <style>
      /* Reset and base styles */
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { 
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        line-height: 1.6;
        color: #333;
        background-color: #f8fafc;
        padding: 20px 0;
      }
      
      /* Container */
      .email-container {
        max-width: 800px;
        margin: 0 auto;
        background: #ffffff;
        border-radius: 12px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        overflow: hidden;
      }
      
      /* Header */
      .email-header {
        background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        color: white;
        padding: 24px 32px;
        text-align: center;
      }
      
      .email-header h1 {
        font-size: 24px;
        font-weight: 700;
        margin: 0;
        letter-spacing: -0.025em;
      }
      
      /* Content */
      .email-content {
        padding: 32px;
      }
      
      .greeting {
        font-size: 18px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 16px;
      }
      
      .intro-text {
        font-size: 16px;
        color: #4b5563;
        margin-bottom: 24px;
        line-height: 1.7;
      }
      
      .intro-text strong {
        color: #1f2937;
        font-weight: 600;
      }
      
      /* Table styling */
      .table-container {
        background: #ffffff;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        margin: 24px 0;
      }
      
      .subject-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
      }
      
      .subject-table thead {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      }
      
      .subject-table th {
        padding: 16px 12px;
        text-align: left;
        font-weight: 700;
        color: #374151;
        border-bottom: 2px solid #d1d5db;
        border-right: 1px solid #e5e7eb;
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      
      .subject-table th:last-child {
        border-right: none;
      }
      
      .subject-table td {
        padding: 14px 12px;
        border-bottom: 1px solid #e5e7eb;
        border-right: 1px solid #e5e7eb;
        vertical-align: top;
      }
      
      .subject-table td:last-child {
        border-right: none;
      }
      
      .subject-table tbody tr:hover {
        background-color: #f9fafb;
      }
      
      .subject-table tbody tr:last-child td {
        border-bottom: none;
      }
      
      .category-cell {
        font-weight: 700;
        color: #1f2937;
        background-color: #f8fafc;
        width: 200px;
      }
      
      .subject-cell {
        color: #374151;
        font-weight: 500;
      }
      
      .empty-cell {
        color: #9ca3af;
        font-style: italic;
      }
      
      /* Footer */
      .email-footer {
        background-color: #f8fafc;
        padding: 24px 32px;
        border-top: 1px solid #e5e7eb;
      }
      
      .footer-text {
        font-size: 14px;
        color: #6b7280;
        margin-bottom: 16px;
        line-height: 1.6;
      }
      
      .signature {
        font-size: 14px;
        color: #374151;
        margin-bottom: 16px;
      }
      
      .signature strong {
        color: #1f2937;
      }
      
      .disclaimer {
        font-size: 12px;
        color: #9ca3af;
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid #e5e7eb;
      }
      
      .copyright {
        text-align: center;
        font-size: 12px;
        color: #9ca3af;
        margin-top: 16px;
      }
      
      /* Responsive */
      @media (max-width: 600px) {
        .email-container {
          margin: 0 16px;
          border-radius: 8px;
        }
        
        .email-header, .email-content, .email-footer {
          padding: 20px;
        }
        
        .email-header h1 {
          font-size: 20px;
        }
        
        .subject-table {
          font-size: 12px;
        }
        
        .subject-table th,
        .subject-table td {
          padding: 10px 8px;
        }
        
        .category-cell {
          width: 150px;
        }
      }
    </style>
  </head>
  <body>
    <div class="email-container">
      <!-- Header -->
      <div class="email-header">
        <h1>Important Notification</h1>
      </div>
      
      <!-- Content -->
      <div class="email-content">
        <div class="greeting">Dear <%= (user && user.name) ? user.name : "Student" %>,</div>
        
        <div class="intro-text">
          Congratulations! You have successfully submitted your <strong>Semester-wise Subject Selection</strong>
          under the Curriculum &amp; Credit Framework (CCF) for the academic year
          <strong><%= content && content.academicYear ? content.academicYear : "" %></strong>.
        </div>
        
        <div class="intro-text">
          <% 
            // Check if user is in BA or BSc program
            const programCourseName = user?.currentPromotion?.programCourse?.name || user?.programCourse?.course?.name || "";
            const normalizedName = programCourseName.toLowerCase().replace(/[.\s]/g, "");
            const isBaOrBscProgram = normalizedName.includes("b.a") || normalizedName.includes("ba") || normalizedName.includes("b.sc") || normalizedName.includes("bsc");
          %>
          <% if (isBaOrBscProgram) { %>
            For your reference & future use, please find below the subject(s) chosen by you:
          <% } else { %>
            For your ready reference, a summary of subjects to be studied by you from <strong>Semesters I to IV</strong> (including the subjects selected by you) is provided below:
          <% } %>
        </div>

        <!-- Subject Selection Table -->
        <div class="table-container">
          <table class="subject-table">
            <thead>
              <tr>
                <th>Subject Category</th>
                <th>Your Selection</th>
              </tr>
            </thead>
            <tbody>
              <% const rows = content && content.subjectsByCategory ? content.subjectsByCategory : {}; %>
              <% 
                // Create the mapping for display format - show all provided selections
                const displayRows = [];
                
                // Helper function to check if a value exists and is not empty
                function hasValue(obj, key) {
                  return obj && obj[key] && obj[key].trim() !== '';
                }
                
                // Minor 1 (Semester I & II)
                if (hasValue(rows["Minor"], "I")) {
                  displayRows.push({
                    category: "Minor 1 (Semester I & II)",
                    selection: rows["Minor"]["I"]
                  });
                }
                
                // Minor 2 (Semester III & IV) - only show if Minor 1 is present (traditional programs)
                if (hasValue(rows["Minor"], "III") && hasValue(rows["Minor"], "I")) {
                  displayRows.push({
                    category: "Minor 2 (Semester III & IV)",
                    selection: rows["Minor"]["III"]
                  });
                }
                
                // Minor 3 (Semester III) - onwards and show if Minor 1 is not present (BCOM programs)
                if (hasValue(rows["Minor"], "III") && !hasValue(rows["Minor"], "I")) {
                  displayRows.push({
                    category: "Minor (Semester III to VI)",
                    selection: rows["Minor"]["III"]
                  });
                }
                
                // IDC 1 (Semester I)
                if (hasValue(rows["IDC"], "I")) {
                  displayRows.push({
                    category: "IDC 1 (Semester I)",
                    selection: rows["IDC"]["I"]
                  });
                }
                
                // IDC 2 (Semester II)
                if (hasValue(rows["IDC"], "II")) {
                  displayRows.push({
                    category: "IDC 2 (Semester II)",
                    selection: rows["IDC"]["II"]
                  });
                }
                
                // IDC 3 (Semester III)
                if (hasValue(rows["IDC"], "III")) {
                  displayRows.push({
                    category: "IDC 3 (Semester III)",
                    selection: rows["IDC"]["III"]
                  });
                }
                
                // AEC (Semester III & IV)
                if (hasValue(rows["AEC"], "III")) {
                  displayRows.push({
                    category: "AEC (Semester III & IV)",
                    selection: rows["AEC"]["III"]
                  });
                }
                
                // CVAC 4 (Semester II)
                if (hasValue(rows["CVAC"], "II")) {
                  displayRows.push({
                    category: "CVAC 4 (Semester II)",
                    selection: rows["CVAC"]["II"]
                  });
                }
              %>
              <% displayRows.forEach(function(row) { %>
                <tr>
                  <td class="category-cell"><%= row.category %></td>
                  <td class="subject-cell"><%= row.selection %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Footer -->
      <div class="email-footer">
        <div class="footer-text">
          Kindly retain this email for your reference during the course of your study.
        </div>
        
        <div class="signature">
          <strong>Best regards,</strong><br>
          <strong>Admission Department</strong><br>
          The Bhawanipur Education Society College
        </div>
        
        <div class="disclaimer">
          This is a system-generated email. Please do not reply to this message.
        </div>
        
        <div class="copyright">
          &copy; <%= new Date().getFullYear() %> The Bhawanipur Education Society College
        </div>
      </div>
    </div>
  </body>
</html>

